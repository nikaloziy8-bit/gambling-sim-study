<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>–°–∏–º—É–ª—è—Ü–∏—è —Å–ª–æ—Ç–æ–≤ ‚Äî —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç</title>
  <style>
    body{
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 900px;
      margin: 0 auto;
      line-height: 1.5;
    }
    h1,h2,h3{
      margin-top: 0;
    }
    .screen{
      display: none;
    }
    .screen.active{
      display: block;
    }
    #balance{
      font-weight: bold;
    }
    .controls{
      margin-top: 10px;
    }
    .controls input[type="number"]{
      width: 80px;
    }
    #message{
      margin-top: 10px;
      min-height: 24px;
    }
    .info-bar{
      margin-top: 10px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    .label{
      font-weight: bold;
    }
    button{
      padding: 6px 14px;
      margin-top: 8px;
      cursor: pointer;
      border-radius: 4px;
      border: 1px solid #888;
      background: #f0f0f0;
    }
    button:disabled{
      opacity: 0.6;
      cursor: default;
    }
    /* –ö—Ä–∞—Å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ä—Ç–∞/—Å–ø–∏–Ω–∞ */
    .btn-primary{
      background: #d60000;
      color: #ffffff;
      border-color: #a00000;
      font-weight: bold;
    }
    .small{
      font-size: 13px;
      color: #555;
    }
    .muted{
      color: #777;
    }
    .error{
      color: #b00020;
      font-size: 13px;
      margin-top: 4px;
    }
    .success{
      color: #006400;
    }

    /* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤ */
    #slotContainer{
      margin-top: 15px;
      display: flex;
      gap: 12px;
      justify-content: center;
      align-items: center;
    }
    .reel{
      width: 80px;
      height: 80px;
      border-radius: 8px;
      border: 2px solid #444;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      background: #fdfdfd;
      box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }
    #slotFrame{
      padding: 10px 16px;
      border-radius: 10px;
      border: 2px solid #ccc;
      background: linear-gradient(135deg, #fafafa, #f0f0f0);
      margin-top: 10px;
    }
    .scale-block{
      margin-bottom: 18px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: #fafafa;
    }
    .scale-block h4{
      margin: 0 0 8px;
    }
    .question{
      margin-bottom: 6px;
    }
    .question label{
      display: block;
      margin-bottom: 2px;
    }
    select, input[type="number"], input[type="text"]{
      padding: 4px 6px;
      border-radius: 4px;
      border: 1px solid #aaa;
      font-size: 13px;
    }
  </style>
</head>
<body>

  <!-- –≠–∫—Ä–∞–Ω 1: –≤–≤–æ–¥ —É—á–∞—Å—Ç–Ω–∏–∫–∞ + –æ–±—â–∞—è –∏–Ω—Ñ–∞ -->
  <div id="screen-intro" class="screen active">
    <h1>–°–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–≥—Ä–∞ ¬´—Å–ª–æ—Ç—ã¬ª</h1>
    <p>
      –í —ç—Ç–æ–º –∑–∞–¥–∞–Ω–∏–∏ –≤—ã –±—É–¥–µ—Ç–µ –∏–≥—Ä–∞—Ç—å –≤ –ø—Ä–æ—Å—Ç—É—é —Å–∏–º—É–ª—è—Ü–∏—é —Å–ª–æ—Ç–æ–≤ —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –±–∞–ª–ª–∞–º–∏.
      –î–µ–Ω–µ–≥ –≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–µ –Ω–µ—Ç, –≤—Å–µ –≤—ã–∏–≥—Ä—ã—à–∏ –∏ –ø—Ä–æ–∏–≥—Ä—ã—à–∏ ‚Äî —É—Å–ª–æ–≤–Ω—ã–µ.
    </p>

    <h3>–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º</h3>
    <p>
      –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ <strong>–ò–º—è</strong>.
      –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å, –≤—ã –º–æ–∂–µ—Ç–µ –≤–≤–µ—Å—Ç–∏ —Å–≤–æ–∏ –∏–Ω–∏—Ü–∏–∞–ª—ã –∏–ª–∏ –ª—é–±–æ–π —É—Å–ª–æ–≤–Ω—ã–π ID.
    </p>

    <label>
      –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–∞:
      <input type="text" id="participantIdInput" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, P001">
    </label>
    <div id="introError" class="error"></div>

    <h3>–ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h3>
    <ul>
      <li>–°—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: <strong>1000 –±–∞–ª–ª–æ–≤</strong>.</li>
      <li>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: <strong>10</strong>, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è: <strong>200</strong>.</li>
      <li>–ö–∞–∂–¥—ã–π —Å–ø–∏–Ω: –≤—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ —Ä–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏ –∏ –Ω–∞–∂–∏–º–∞–µ—Ç–µ –∫—Ä–∞—Å–Ω—É—é –∫–Ω–æ–ø–∫—É <strong>¬´–°–ü–ò–ù¬ª</strong>.</li>
      <li>–°–µ—Å—Å–∏—è –¥–ª–∏—Ç—Å—è <strong>—Ä–æ–≤–Ω–æ 15 –º–∏–Ω—É—Ç</strong>, –ø–æ—Å–ª–µ —á–µ–≥–æ –∏–≥—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.</li>
    </ul>

    <p class="small muted">
      –°–Ω–∞—á–∞–ª–∞ –≤—ã –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ—Ä–æ—Ç–∫–∏—Ö –æ–ø—Ä–æ—Å–Ω–∏–∫–æ–≤, –∑–∞—Ç–µ–º –ø—Ä–æ–π–¥—ë—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ (3 —Å–ø–∏–Ω–∞),
      –∞ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–∞—á–Ω—ë—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è —Å–µ—Å—Å–∏—è.
    </p>

    <button id="btnGoSurvey" class="btn-primary">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø—Ä–æ—Å–Ω–∏–∫–∞–º</button>
  </div>

  <!-- –≠–∫—Ä–∞–Ω 2: –æ–ø—Ä–æ—Å–Ω–∏–∫–∏ -->
  <div id="screen-survey" class="screen">
    <h2>–û–ø—Ä–æ—Å–Ω–∏–∫–∏ –ø–µ—Ä–µ–¥ –∏–≥—Ä–æ–π</h2>
    <p class="small muted">
      –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã. –í –¥–∞–ª—å–Ω–µ–π—à–µ–º —è —Ä–∞—Å—Å—à–∏—Ä—é —Å–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤.
    </p>

    <div class="scale-block">
      <h4>PGSI ‚Äî –ü—Ä–æ–±–ª–µ–º–Ω–æ–µ –∞–∑–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ </h4>
      <div class="question">
        <label for="pgsi_q1">1. –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥ –≤—ã –∏–≥—Ä–∞–ª–∏ –Ω–∞ –±–æ–ª—å—à–∏–µ —Å—É–º–º—ã, —á–µ–º –º–æ–≥–ª–∏ —Å–µ–±–µ –ø–æ–∑–≤–æ–ª–∏—Ç—å?</label>
        <select id="pgsi_q1">
          <option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
          <option value="0">0 ‚Äî –Ω–∏–∫–æ–≥–¥–∞</option>
          <option value="1">1 ‚Äî —Ä–µ–∂–µ, —á–µ–º —Ä–∞–∑ –≤ –º–µ—Å—è—Ü</option>
          <option value="2">2 ‚Äî –æ—Ç 1 —Ä–∞–∑–∞ –≤ –º–µ—Å—è—Ü –¥–æ 1 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é</option>
          <option value="3">3 ‚Äî —á–∞—â–µ, —á–µ–º —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é</option>
        </select>
      </div>
      <div class="question">
        <label for="pgsi_q2">2. –ë—ã–≤–∞–ª–∏ –ª–∏ —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ –∏–≥—Ä–∞ –≤—ã–∑—ã–≤–∞–ª–∞ —É –≤–∞—Å –ø—Ä–æ–±–ª–µ–º—ã (—Å–µ–º–µ–π–Ω—ã–µ, —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∏ –¥—Ä.)?</label>
        <select id="pgsi_q2">
          <option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
          <option value="0">0 ‚Äî –Ω–∏–∫–æ–≥–¥–∞</option>
          <option value="1">1 ‚Äî –∏–Ω–æ–≥–¥–∞</option>
          <option value="2">2 ‚Äî —á–∞—Å—Ç–æ</option>
          <option value="3">3 ‚Äî –æ—á–µ–Ω—å —á–∞—Å—Ç–æ</option>
        </select>
      </div>
      <div class="question">
        <label for="pgsi_q3">3. –ü—ã—Ç–∞–ª–∏—Å—å –ª–∏ –≤—ã –≤–µ—Ä–Ω—É—Ç—å –ø—Ä–æ–∏–≥—Ä–∞–Ω–Ω—ã–µ –¥–µ–Ω—å–≥–∏, –ø—Ä–æ–¥–æ–ª–∂–∞—è –∏–≥—Ä–∞—Ç—å?</label>
        <select id="pgsi_q3">
          <option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
          <option value="0">0 ‚Äî –Ω–∏–∫–æ–≥–¥–∞</option>
          <option value="1">1 ‚Äî –∏–Ω–æ–≥–¥–∞</option>
          <option value="2">2 ‚Äî —á–∞—Å—Ç–æ</option>
          <option value="3">3 ‚Äî –æ—á–µ–Ω—å —á–∞—Å—Ç–æ</option>
        </select>
      </div>
    </div>

    <div class="scale-block">
      <h4>–ò–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å (BIS-11 / UPPS)</h4>
      <div class="question">
        <label for="imp_q1">1. –ú–Ω–µ —Å–ª–æ–∂–Ω–æ —Å–¥–µ—Ä–∂–∞—Ç—å—Å—è, –∫–æ–≥–¥–∞ —è —Ö–æ—á—É —á—Ç–æ-—Ç–æ —Å–¥–µ–ª–∞—Ç—å.</label>
        <select id="imp_q1">
          <option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
          <option value="1">1 ‚Äî —Å–æ–≤—Å–µ–º –Ω–µ –ø—Ä–æ –º–µ–Ω—è</option>
          <option value="2">2 ‚Äî —Å–∫–æ—Ä–µ–µ –Ω–µ –ø—Ä–æ –º–µ–Ω—è</option>
          <option value="3">3 ‚Äî —Å–∫–æ—Ä–µ–µ –ø—Ä–æ –º–µ–Ω—è</option>
          <option value="4">4 ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ –º–µ–Ω—è</option>
        </select>
      </div>
      <div class="question">
        <label for="imp_q2">2. –Ø —á–∞—Å—Ç–æ –¥–µ–ª–∞—é —á—Ç–æ-—Ç–æ, –Ω–µ –æ–±–¥—É–º–∞–≤ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è.</label>
        <select id="imp_q2">
          <option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
          <option value="1">1 ‚Äî —Å–æ–≤—Å–µ–º –Ω–µ –ø—Ä–æ –º–µ–Ω—è</option>
          <option value="2">2 ‚Äî —Å–∫–æ—Ä–µ–µ –Ω–µ –ø—Ä–æ –º–µ–Ω—è</option>
          <option value="3">3 ‚Äî —Å–∫–æ—Ä–µ–µ –ø—Ä–æ –º–µ–Ω—è</option>
          <option value="4">4 ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ –º–µ–Ω—è</option>
        </select>
      </div>
      <div class="question">
        <label for="imp_q3">3. –ú–Ω–µ —Ç—Ä—É–¥–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è, –µ—Å–ª–∏ —è —á–µ–º-—Ç–æ —É–≤–ª—ë–∫—Å—è(–ª–∞—Å—å).</label>
        <select id="imp_q3">
          <option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
          <option value="1">1 ‚Äî —Å–æ–≤—Å–µ–º –Ω–µ –ø—Ä–æ –º–µ–Ω—è</option>
          <option value="2">2 ‚Äî —Å–∫–æ—Ä–µ–µ –Ω–µ –ø—Ä–æ –º–µ–Ω—è</option>
          <option value="3">3 ‚Äî —Å–∫–æ—Ä–µ–µ –ø—Ä–æ –º–µ–Ω—è</option>
          <option value="4">4 ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ –º–µ–Ω—è</option>
        </select>
      </div>
    </div>

    <div class="scale-block">
      <h4>–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (DASS-21 ‚Äî –ø—Ä–∏–º–µ—Ä)</h4>
      <div class="question">
        <label for="dass_q1">1. –í –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–Ω–∏ —è —á—É–≤—Å—Ç–≤—É—é —Å–∏–ª—å–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –∏–ª–∏ —Ç—Ä–µ–≤–æ–≥—É.</label>
        <select id="dass_q1">
          <option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
          <option value="0">0 ‚Äî –ø–æ—á—Ç–∏ –Ω–∏–∫–æ–≥–¥–∞</option>
          <option value="1">1 ‚Äî –∏–Ω–æ–≥–¥–∞</option>
          <option value="2">2 ‚Äî —á–∞—Å—Ç–æ</option>
          <option value="3">3 ‚Äî –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞</option>
        </select>
      </div>
      <div class="question">
        <label for="dass_q2">2. –í –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –º–Ω–µ —Ç—Ä—É–¥–Ω–æ –ø–æ–ª—É—á–∞—Ç—å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ –æ—Ç –æ–±—ã—á–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π.</label>
        <select id="dass_q2">
          <option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
          <option value="0">0 ‚Äî –ø–æ—á—Ç–∏ –Ω–∏–∫–æ–≥–¥–∞</option>
          <option value="1">1 ‚Äî –∏–Ω–æ–≥–¥–∞</option>
          <option value="2">2 ‚Äî —á–∞—Å—Ç–æ</option>
          <option value="3">3 ‚Äî –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞</option>
        </select>
      </div>
      <div class="question">
        <label for="dass_q3">3. –Ø —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —É—Å—Ç–∞–≤—à–∏–º(–æ–π) –∏ –∏—Å—Ç–æ—â—ë–Ω–Ω—ã–º(–æ–π).</label>
        <select id="dass_q3">
          <option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
          <option value="0">0 ‚Äî –ø–æ—á—Ç–∏ –Ω–∏–∫–æ–≥–¥–∞</option>
          <option value="1">1 ‚Äî –∏–Ω–æ–≥–¥–∞</option>
          <option value="2">2 ‚Äî —á–∞—Å—Ç–æ</option>
          <option value="3">3 ‚Äî –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞</option>
        </select>
      </div>
    </div>

    <div class="scale-block">
      <h4>–¢–µ–∫—É—â–µ–µ –≤–ª–µ—á–µ–Ω–∏–µ –∫ –∏–≥—Ä–µ</h4>
      <div class="question">
        <label for="urge_now">–ù–∞—Å–∫–æ–ª—å–∫–æ —Å–∏–ª—å–Ω–æ –≤—ã —Å–µ–π—á–∞—Å —Ö–æ—Ç–∏—Ç–µ –∏–≥—Ä–∞—Ç—å (0‚Äì10)?</label>
        <input type="number" id="urge_now" min="0" max="10" placeholder="0‚Äì10">
      </div>
    </div>

    <div id="surveyError" class="error"></div>
    <button id="btnSurveyNext" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç—ã –∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Ç–µ—Å—Ç–æ–≤–æ–º—É —Ä–∞—É–Ω–¥—É</button>
  </div>

  <!-- –≠–∫—Ä–∞–Ω 3: —Ç–µ—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ -->
  <div id="screen-test" class="screen">
    <h2>–¢–µ—Å—Ç–æ–≤—ã–π —Ä–∞—É–Ω–¥</h2>
    <p>
      –°–µ–π—á–∞—Å –≤—ã –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–±–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫ (–¥–æ 3 —Å–ø–∏–Ω–æ–≤), —á—Ç–æ–±—ã –ø—Ä–∏–≤—ã–∫–Ω—É—Ç—å –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É.
      –≠—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã <strong>–Ω–µ</strong> –≤–æ–π–¥—É—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª.
    </p>
    <div>–¢–µ—Å—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: <span id="testBalance">100000</span> –±–∞–ª–ª–æ–≤</div>
    <div class="controls">
      –°—Ç–∞–≤–∫–∞:
      <input type="number" id="testStake" min="10" max="2000" value="10">
      <button id="btnTestSpin" class="btn-primary">–°–ü–ò–ù (—Ç–µ—Å—Ç)</button>
    </div>
    <div id="testMessage" style="margin-top:10px"></div>
    <p class="small muted">
      –ü–æ—Å–ª–µ 3 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ä–∞—É–Ω–¥–æ–≤ –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –∫ –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Å—Ç–∏.
    </p>
    <button id="btnStartMain" disabled>–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏</button>
  </div>

  <!-- –≠–∫—Ä–∞–Ω 4: –æ—Å–Ω–æ–≤–Ω–∞—è —Å–µ—Å—Å–∏—è -->
  <div id="screen-main" class="screen">
    <h2>–û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è —Å–µ—Å—Å–∏—è</h2>
    <div class="info-bar">
      <span class="label">ID —É—á–∞—Å—Ç–Ω–∏–∫–∞:</span> <span id="infoParticipantId"></span><br>
      <span class="label">–û—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è:</span> <span id="timerDisplay">15:00</span><br>
      <span class="label">–ë–∞–ª–∞–Ω—Å:</span> <span id="balance">1000</span> –±–∞–ª–ª–æ–≤<br>
      <span class="label">–ù–æ–º–µ—Ä —Ä–∞—É–Ω–¥–∞:</span> <span id="trialCounter">0</span>
    </div>

    <div id="slotFrame">
      <div id="slotContainer">
        <div class="reel" id="reel1">üçí</div>
        <div class="reel" id="reel2">üçã</div>
        <div class="reel" id="reel3">üîî</div>
      </div>
    </div>

    <div class="controls">
      –°—Ç–∞–≤–∫–∞:
      <input type="number" id="stake" min="10" max="200" value="10">
      <button id="spin" class="btn-primary">–°–ü–ò–ù</button>
    </div>

    <div id="message"></div>

    <p class="small muted">
      –í—ã –º–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.
    </p>
    <button id="btnEndEarly">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Å—Å–∏—é –¥–æ—Å—Ä–æ—á–Ω–æ</button>
  </div>

  <!-- –≠–∫—Ä–∞–Ω 5: –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ -->
  <div id="screen-end" class="screen">
    <h2>–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞</h2>
    <p id="endReason"></p>
    <p>
      –ù–∏–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ <strong>JSON</strong>.
      –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º –∏–≥—Ä–æ–≤–æ–º —Ä–∞—É–Ω–¥–µ –∏ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ–ø—Ä–æ—Å–Ω–∏–∫–∏.
    </p>
    <button id="btnDownloadJson">–°–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (.json)</button>
    <p class="small muted">
      –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –≤—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–¥–∞—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—é –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —É —Å–µ–±—è.
    </p>
  </div>

  <script>
    // --------- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ ----------
    const SESSION_DURATION_MS = 15 * 60 * 1000; // 15 –º–∏–Ω—É—Ç
    const INITIAL_BALANCE = 1000;
    const MIN_STAKE = 10;
    const MAX_STAKE = 200;

    // --------- –°–æ—Å—Ç–æ—è–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ ----------
    let participantId = null;
    let mainBalance = INITIAL_BALANCE;
    let mainTrial = 0;
    let sessionStartTime = null;
    let sessionEndTime = null;
    let sessionTimerId = null;
    let sessionDeadline = null;
    let lastReadyTime = null;
    let logs = []; // –¥–∞–Ω–Ω—ã–µ –ø–æ —Ä–∞—É–Ω–¥–∞–º
    let surveyData = {}; // –æ—Ç–≤–µ—Ç—ã –æ–ø—Ä–æ—Å–Ω–∏–∫–æ–≤

    // –î–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Å–ª–æ—Ç–æ–≤
    const slotSymbols = ['üçí','üçã','üîî','‚≠ê','7Ô∏è‚É£','üçâ'];
    let reelIntervals = [];
    const SPIN_ANIMATION_DURATION = 800; // –º—Å

    // --------- –≠–ª–µ–º–µ–Ω—Ç—ã DOM ----------
    const screenIntro = document.getElementById('screen-intro');
    const screenSurvey = document.getElementById('screen-survey');
    const screenTest = document.getElementById('screen-test');
    const screenMain = document.getElementById('screen-main');
    const screenEnd = document.getElementById('screen-end');

    const introError = document.getElementById('introError');
    const participantIdInput = document.getElementById('participantIdInput');
    const btnGoSurvey = document.getElementById('btnGoSurvey');

    const surveyError = document.getElementById('surveyError');
    const btnSurveyNext = document.getElementById('btnSurveyNext');

    const testBalanceEl = document.getElementById('testBalance');
    const testStakeEl = document.getElementById('testStake');
    const btnTestSpin = document.getElementById('btnTestSpin');
    const testMessage = document.getElementById('testMessage');
    const btnStartMain = document.getElementById('btnStartMain');

    const infoParticipantId = document.getElementById('infoParticipantId');
    const timerDisplay = document.getElementById('timerDisplay');
    const balanceEl = document.getElementById('balance');
    const stakeEl = document.getElementById('stake');
    const spinBtn = document.getElementById('spin');
    const message = document.getElementById('message');
    const trialCounterEl = document.getElementById('trialCounter');
    const btnEndEarly = document.getElementById('btnEndEarly');

    const screenEndReason = document.getElementById('endReason');
    const btnDownloadJson = document.getElementById('btnDownloadJson');

    const reel1 = document.getElementById('reel1');
    const reel2 = document.getElementById('reel2');
    const reel3 = document.getElementById('reel3');

    // --------- –•—ç–ª–ø–µ—Ä—ã –¥–ª—è —ç–∫—Ä–∞–Ω–æ–≤ ----------
    function showScreen(screen){
      [screenIntro, screenSurvey, screenTest, screenMain, screenEnd].forEach(s => s.classList.remove('active'));
      screen.classList.add('active');
    }

    // --------- –ü–µ—Ä–µ—Ö–æ–¥ –∫ –æ–ø—Ä–æ—Å–Ω–∏–∫–∞–º ----------
    btnGoSurvey.addEventListener('click', () => {
      const id = participantIdInput.value.trim();
      if(!id){
        introError.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–∞.';
        return;
      }
      introError.textContent = '';
      participantId = id;
      showScreen(screenSurvey);
    });

    // --------- –°–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤ –æ–ø—Ä–æ—Å–Ω–∏–∫–æ–≤ ----------
    btnSurveyNext.addEventListener('click', () => {
      // –°–æ–±–∏—Ä–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
      const pgsi_q1 = document.getElementById('pgsi_q1').value;
      const pgsi_q2 = document.getElementById('pgsi_q2').value;
      const pgsi_q3 = document.getElementById('pgsi_q3').value;

      const imp_q1 = document.getElementById('imp_q1').value;
      const imp_q2 = document.getElementById('imp_q2').value;
      const imp_q3 = document.getElementById('imp_q3').value;

      const dass_q1 = document.getElementById('dass_q1').value;
      const dass_q2 = document.getElementById('dass_q2').value;
      const dass_q3 = document.getElementById('dass_q3').value;

      const urge_now_str = document.getElementById('urge_now').value;

      // –ü—Ä–æ—Å—Ç–µ–π—à–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å
      const fields = [pgsi_q1, pgsi_q2, pgsi_q3,
                      imp_q1, imp_q2, imp_q3,
                      dass_q1, dass_q2, dass_q3,
                      urge_now_str];

      if(fields.some(v => v === '')){
        surveyError.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º.';
        return;
      }
      const urge_now = Number(urge_now_str);
      if(isNaN(urge_now) || urge_now < 0 || urge_now > 10){
        surveyError.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å –≤–ª–µ—á–µ–Ω–∏—è –∫ –∏–≥—Ä–µ –æ—Ç 0 –¥–æ 10.';
        return;
      }

      surveyError.textContent = '';

      surveyData = {
        pgsi_example: {
          q1: Number(pgsi_q1),
          q2: Number(pgsi_q2),
          q3: Number(pgsi_q3)
        },
        impulsivity_example: {
          q1: Number(imp_q1),
          q2: Number(imp_q2),
          q3: Number(imp_q3)
        },
        dass_example: {
          q1: Number(dass_q1),
          q2: Number(dass_q2),
          q3: Number(dass_q3)
        },
        urge_now: urge_now
      };

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –±–ª–æ–∫
      testBalance = INITIAL_BALANCE;
      testTrials = 0;
      testBalanceEl.textContent = testBalance;
      testMessage.textContent = '';
      btnStartMain.disabled = true;

      showScreen(screenTest);
    });

    // --------- –¢–µ—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ ----------
    let testBalance = INITIAL_BALANCE;
    let testTrials = 0;
    const MAX_TEST_TRIALS = 3;

    btnTestSpin.addEventListener('click', () => {
      const stake = Number(testStakeEl.value);
      if(stake < MIN_STAKE || stake > MAX_STAKE){
        alert(`–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç ${MIN_STAKE} –¥–æ ${MAX_STAKE}.`);
        return;
      }
      if(stake > testBalance){
        alert('–°—Ç–∞–≤–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å.');
        return;
      }

      const r = Math.random();
      let outcome = -stake;
      if(r < 0.01){
        outcome = stake * 100 - stake;
      } else if(r < 0.10){
        outcome = stake * 5 - stake;
      }
      testBalance += outcome;
      testTrials += 1;
      testBalanceEl.textContent = testBalance;

      testMessage.textContent =
        `–¢–µ—Å—Ç–æ–≤—ã–π —Ä–∞—É–Ω–¥ ${testTrials}: —Ä–µ–∑—É–ª—å—Ç–∞—Ç ${outcome >= 0 ? '+'+outcome : outcome} (–±–∞–ª–∞–Ω—Å ${testBalance}).`;

      if(testTrials >= MAX_TEST_TRIALS){
        btnStartMain.disabled = false;
        testMessage.textContent += ' –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏.';
      }
    });

    btnStartMain.addEventListener('click', () => {
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Å–µ—Å—Å–∏—é
      mainBalance = INITIAL_BALANCE;
      mainTrial = 0;
      logs = [];
      sessionStartTime = new Date();
      sessionDeadline = sessionStartTime.getTime() + SESSION_DURATION_MS;
      balanceEl.textContent = mainBalance;
      trialCounterEl.textContent = mainTrial.toString();
      infoParticipantId.textContent = participantId;
      message.textContent = '';
      lastReadyTime = performance.now();

      startSessionTimer();
      showScreen(screenMain);
    });

    // --------- –¢–∞–π–º–µ—Ä —Å–µ—Å—Å–∏–∏ ----------
    function startSessionTimer(){
      updateTimerDisplay();
      sessionTimerId = setInterval(() => {
        const now = Date.now();
        if(now >= sessionDeadline){
          endSession('–í—Ä–µ–º—è —Å–µ—Å—Å–∏–∏ –∏—Å—Ç–µ–∫–ª–æ (15 –º–∏–Ω—É—Ç).');
        } else {
          updateTimerDisplay();
        }
      }, 1000);
    }

    function updateTimerDisplay(){
      const now = Date.now();
      let remaining = Math.max(0, sessionDeadline - now);
      const totalSeconds = Math.floor(remaining / 1000);
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      timerDisplay.textContent =
        String(minutes).padStart(2,'0') + ':' + String(seconds).padStart(2,'0');
    }

    // --------- –ê–Ω–∏–º–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤ ----------
    function startReelAnimation(){
      const reels = [reel1, reel2, reel3];
      reelIntervals = reels.map(reel => {
        return setInterval(() => {
          const sym = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
          reel.textContent = sym;
        }, 80 + Math.random()*40);
      });
    }

    function stopReelAnimation(){
      reelIntervals.forEach(id => clearInterval(id));
      reelIntervals = [];
      // –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ –∫–æ–Ω—Ü–µ
      [reel1, reel2, reel3].forEach(reel => {
        const sym = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
        reel.textContent = sym;
      });
    }

    // --------- –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Å–ø–∏–Ω ----------
    spinBtn.addEventListener('click', () => {
      const now = Date.now();
      if(now >= sessionDeadline){
        endSession('–í—Ä–µ–º—è —Å–µ—Å—Å–∏–∏ –∏—Å—Ç–µ–∫–ª–æ (15 –º–∏–Ω—É—Ç).');
        return;
      }

      const stake = Number(stakeEl.value);
      if(stake < MIN_STAKE || stake > MAX_STAKE){
        alert(`–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç ${MIN_STAKE} –¥–æ ${MAX_STAKE}.`);
        return;
      }
      if(stake > mainBalance){
        alert('–°—Ç–∞–≤–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å.');
        return;
      }

      // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏
      spinBtn.disabled = true;

      const nowPerf = performance.now();
      const reactionTime = lastReadyTime ? (nowPerf - lastReadyTime) : null;

      // –°—Ä–∞–∑—É –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∏—Å—Ö–æ–¥, –∞ –≤–∏–∑—É–∞–ª ‚Äî –ø—Ä–æ—Å—Ç–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ
      const r = Math.random();
      let outcome = -stake;
      if(r < 0.01){
        outcome = stake * 100 - stake;
      } else if(r < 0.10){
        outcome = stake * 5 - stake;
      }

      startReelAnimation();

      setTimeout(() => {
        stopReelAnimation();

        mainBalance += outcome;
        mainTrial += 1;
        balanceEl.textContent = mainBalance;
        trialCounterEl.textContent = mainTrial.toString();

        const trialInfo = {
          participant_id: participantId,
          timestamp: new Date().toISOString(),
          trial_number: mainTrial,
          stake_amount: stake,
          outcome_amount: outcome,
          balance_after: mainBalance,
          reaction_time_ms: reactionTime
        };
        logs.push(trialInfo);

        message.textContent =
          `–†–∞—É–Ω–¥ ${mainTrial}: —Ä–µ–∑—É–ª—å—Ç–∞—Ç ${outcome >= 0 ? '+'+outcome : outcome} (–±–∞–ª–∞–Ω—Å ${mainBalance}).`;

        if(mainBalance < MIN_STAKE){
          endSession('–ë–∞–ª–∞–Ω—Å —Å—Ç–∞–ª –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–≤–∫–∏. –°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞.');
          return;
        }

        lastReadyTime = performance.now();
        spinBtn.disabled = false;
      }, SPIN_ANIMATION_DURATION);
    });

    // --------- –î–æ—Å—Ä–æ—á–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ ----------
    btnEndEarly.addEventListener('click', () => {
      const confirmEnd = confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –¥–æ—Å—Ä–æ—á–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Å—Å–∏—é?');
      if(confirmEnd){
        endSession('–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–º –¥–æ—Å—Ä–æ—á–Ω–æ.');
      }
    });

    // --------- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ ----------
    function endSession(reasonText){
      if(sessionTimerId){
        clearInterval(sessionTimerId);
        sessionTimerId = null;
      }
      sessionEndTime = new Date();

      screenEndReason.textContent = reasonText;
      showScreen(screenEnd);
    }

    // --------- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ JSON ----------
    btnDownloadJson.addEventListener('click', () => {
      const data = {
        meta: {
          participant_id: participantId,
          session_start: sessionStartTime ? sessionStartTime.toISOString() : null,
          session_end: sessionEndTime ? sessionEndTime.toISOString() : null,
          initial_balance: INITIAL_BALANCE,
          min_stake: MIN_STAKE,
          max_stake: MAX_STAKE,
          model_description: '–¥–∂–µ–∫–ø–æ—Ç 1% x100; –º–∞–ª–µ–Ω—å–∫–∏–π –≤—ã–∏–≥—Ä—ã—à 9% x5; –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–æ–∏–≥—Ä—ã—à',
          total_trials: mainTrial
        },
        survey: surveyData,
        trials: logs
      };

      const jsonStr = JSON.stringify(data, null, 2);
      const blob = new Blob([jsonStr], {type: 'application/json'});
      const url = URL.createObjectURL(blob);

      const ts = new Date().toISOString().replace(/[:.]/g, '-');
      const safeId = (participantId || 'participant').replace(/[^a-zA-Z0-9_-]/g, '_');
      const filename = `gambling_sim_${safeId}_${ts}.json`;

      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
